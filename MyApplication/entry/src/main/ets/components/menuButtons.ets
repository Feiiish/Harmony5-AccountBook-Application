//from system
import { PersistenceV2, promptAction, router } from '@kit.ArkUI';
import i18n from '@ohos.i18n'

//from myself
import { calculateTotalAssets, } from "../utils/moneyCount"
import { RecordItem, RecordsData, LedgerManager, LedgerBook } from '../models/recordItemReference';
import { MultiCurrencyComposition } from '../components/multiCurrency';
import { UserSetting } from "../models/userSetting"
import { WeeklyChart, calculateWeeklyData } from "../components/charts/weeklyChart"
import { ratesStatus } from "../components/RatesStatus"

//components
import { BottomNavigation } from "../components/bottomNavi"
import { RecordListView, MonthlySummaryPanel } from '../components/mainPageComponents';

import { budgetComponent } from '../components/bugetComponent';
import { searchBarView } from '../components/searchBar';
import { datePicker } from '../components/buttons/MonthPicker';
import { Constants } from '../common/Constants';
import { resourceManager } from '@kit.LocalizationKit';
import { formatDateAdvanced } from '../utils/formatDateAdvanced';

@Styles
function buttonList() {
  .backgroundColor($r('app.color.Basic_Card_background'))
  .padding(6)
  .width('90%')
  .borderRadius(14)
  .margin({ bottom: 12 })
}

@Styles
function buttonItemStyle() {
  .backgroundColor($r('app.color.Basic_Card_background'))
  .padding(6)
  .width('90%')
  .borderRadius(14)
  .margin({ bottom: 12 })
}


@Entry
@ComponentV2
export struct menuButtons {
  build() {
    Column() {

      LedgerUI()
      ratesStatus().margin({ bottom: 8 })
      functionButtons1()
      Button()
        .onClick(() => {
          router.pushUrl({
            url: "pages/AddLegerBookPage"
          }, router.RouterMode.Standard, (err) => {
            if (err) {
              console.log("è·³è½¬å¤±è´¥:", err)
            }
          })
        })

    }

  }
}


@ComponentV2
export struct functionButtons1 {
  @Local
  ledgerManager: LedgerManager = PersistenceV2.connect(
    LedgerManager,
    'multiLedgerStorage',
    () => new LedgerManager()
  )!;
  @Local recordsData: RecordsData = this.ledgerManager.activeBook.data
  @Local menuItems: string[] = [
    'è´§å¸è®¾ç½®',
    'åˆ é™¤è®°å½•',
    'éšç§æ”¿ç­–',
  ];

  handleMenuItemClick(item: string) {
    switch (item) {
      case "è´§å¸è®¾ç½®":
        router.pushUrl({
          url: "pages/CurrencySetting"
        }, router.RouterMode.Standard, (err) => {
          if (err) {
            console.log("è·³è½¬å¤±è´¥:", err)
          }
        })
        console.log('æ‰§è¡Œè´§å¸è®¾ç½®');
        break;
      case "åˆ é™¤è®°å½•":
        AlertDialog.show({
          title: `è¦åˆ é™¤è®°å½•å—`,
          message: `æ­¤æ“ä½œä¸å¯é€€å›`,
          buttons: [
            {
              value: 'å–æ¶ˆ',
              action: () => {
              }
            },
            {
              value: 'ç¡®è®¤',
              action: () => {
                this.recordsData.items = []
                console.log('æ‰§è¡Œåˆ é™¤æ“ä½œ');
              }
            },
          ]
        })

        break;

      case "éšç§æ”¿ç­–":
        router.pushUrl({
          url: "pages/AboutThisApp"
        }, router.RouterMode.Standard, (err) => {
          if (err) {
            console.log("è·³è½¬å¤±è´¥:", err)
          }
        })
        break;
      // å…¶ä»–case...
    }
  }

  private getMenuItemIcon(item: string): string {
    const iconMap: Record<string, string> = {
      'è´§å¸è®¾ç½®': 'ï¸ğŸ’´',
      'åˆ é™¤è®°å½•': 'ğŸ—‘ï¸',
      'åˆ†äº«è®°å½•': 'â†—ï¸',
      'éšç§æ”¿ç­–': 'ğŸ”’',
      'è®¾ç½®': 'âš™ï¸',
      'å¸®åŠ©': 'â“',
      'å…³äºåº”ç”¨': 'â„¹ï¸'
    };
    return iconMap[item] || 'â–ªï¸'; // é»˜è®¤ç¬¦å·
  }

  build() {
    Column() {
      ForEach(this.menuItems, (item: string, index: number) => {
        Column() {
          Row() {
            // å›¾æ ‡ï¼ˆä½¿ç”¨Unicodeç¬¦å·ï¼‰
            Text(this.getMenuItemIcon(item))
              .fontSize(20)
              .margin({ right: 12 })
              .fontColor('#007AFF')
            // æ–‡å­—
            Text(item)
              .fontSize(16)
              .layoutWeight(1)
            // ç®­å¤´ï¼ˆUnicodeç¬¦å·ï¼‰
            if (index < this.menuItems.length - 1) {
              Text('â¯')
                .fontSize(14)
                .fontColor('#999999')
            }
          }
          .height(48)
          .width('100%')
          .padding({ left: 16, right: 16 })
          .onClick(() => {
            this.handleMenuItemClick(item);

            this.getUIContext().animateTo({
              duration: Constants.ANIMATION_DURATION,
              curve: Curve.EaseOut,
              playMode: PlayMode.Normal,
            }, () => {
              // åŠ¨ç”»å®Œæˆåçš„å›è°ƒ
            })
          })

          if (index < this.menuItems.length - 1) {
            Divider()
              .strokeWidth(1)
              .color('#F0F0F0')
              .margin({ left: 24, right: 46 }) // ä¸å›¾æ ‡å¯¹é½
          }
        }
      })
    }
    .buttonList()

  }
}

// LedgerUI.ets
@ComponentV2
export struct LedgerUI {
  @Local
  ledgerManager: LedgerManager = PersistenceV2.connect(
    LedgerManager,
    'multiLedgerStorage',
    () => new LedgerManager()
  )!;
  @Local recordsData: RecordsData = this.ledgerManager.activeBook.data
  @Local newBookName: string = '';

  build() {
    Column({ space: 12 }) {
      Row() {
        Text('è´¦æœ¬é€‰æ‹© 1/3')
        Text('â¯')
          .fontSize(14)
          .fontColor('#999999')
      }.justifyContent(FlexAlign.SpaceBetween).width('95%').onClick(() => {

      })

      ForEach(this.ledgerManager.books, (book: LedgerBook) => {

        Text(book.name)
          .onClick(() => {
            this.ledgerManager.switchBook(book.id);
            this.recordsData = this.ledgerManager.activeBook.data;
          })
          .backgroundColor(book.id === this.ledgerManager.activeBookId ? $r('app.color.Currency_Card_Main') :
          $r('app.color.Currency_Card_1'))
          .width("90%")
          .textAlign(TextAlign.Center)
          .padding(8)
          .borderRadius(28)
          .shadow(ShadowStyle.OUTER_DEFAULT_XS)

      })


    }
    .buttonList()
    .padding(12)
  }
}
