import { PersistenceV2, promptAction, router } from '@kit.ArkUI';
import { RecordItem, RecordsData } from "../../models/recordItemReference"

const RECORDS_DATA_KEY = 'incomeExpenseRecords';

@ComponentV2
export struct PopupComponent {
  @Local handlePopup: boolean = false;
  @Local menuItems: string[] = ['ç¼–è¾‘è®°å½•', 'åˆ é™¤è®°å½•', 'åˆ†äº«è®°å½•', 'å¯¼å‡ºè®°å½•'];
  @Local
  recordsData: RecordsData = PersistenceV2.connect(
    RecordsData,
    RECORDS_DATA_KEY,
    () => new RecordsData()
  )!;

  @Builder
  popupBuilder() {
    Column() {
      Text('è¯·é€‰æ‹©æ“ä½œ')
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .fontColor('#333333')
        .margin({ bottom: 12 })

      // ç¾åŒ–åˆ—è¡¨
      Column() {
        ForEach(this.menuItems, (item: string, index: number) => {
          Column() {
            // èœå•é¡¹
            Row() {
              // å›¾æ ‡ï¼ˆä½¿ç”¨Unicodeç¬¦å·ï¼‰
              Text(this.getMenuItemIcon(item))
                .fontSize(20)
                .margin({ right: 12 })
                .fontColor('#007AFF')

              // æ–‡å­—
              Text(item)
                .fontSize(16)
                .fontColor('#333333')
                .layoutWeight(1)

              // ç®­å¤´ï¼ˆUnicodeç¬¦å·ï¼‰
              if (index < this.menuItems.length - 1) {
                Text('â¯')
                  .fontSize(14)
                  .fontColor('#999999')
              }
            }
            .height(48)
            .width('100%')
            .padding({ left: 16, right: 16 })
            .onClick(() => {
              this.handleMenuItemClick(item);
              this.handlePopup = false;
            })


            // åˆ†éš”çº¿ï¼ˆæœ€åä¸€é¡¹ä¸åŠ ï¼‰
            if (index < this.menuItems.length - 1) {
              Divider()
                .strokeWidth(1)
                .color('#F0F0F0')
                .margin({ left: 44, right: 16 }) // ä¸å›¾æ ‡å¯¹é½
            }
          }
        })
      }
      .width('100%')
      .borderRadius(8)
      .backgroundColor('#FFFFFF')
      .clip(true) // ç¡®ä¿åœ†è§’è£å‰ªç”Ÿæ•ˆ

      // å–æ¶ˆæŒ‰é’®
      Button('å–æ¶ˆ', { type: ButtonType.Normal })
        .width('100%')
        .height(40)
        .margin({ top: 12 })
        .fontColor('#666666')
        .backgroundColor('#F7F7F7')
        .onClick(() => {

        })
    }
    .padding(16)
    .width(280)
    .backgroundColor('#FFFFFF')
    .borderRadius(12)
    .shadow({ radius: 16, color: '#10000000' })
  }

  // èœå•é¡¹ç‚¹å‡»å¤„ç†
  handleMenuItemClick(item: string) {
    switch (item) {
      case 'ç¼–è¾‘è®°å½•':
        console.log('æ‰§è¡Œç¼–è¾‘æ“ä½œ');
        break;
      case 'åˆ é™¤è®°å½•':

        this.recordsData.items = []

        console.log('æ‰§è¡Œåˆ é™¤æ“ä½œ');

        break;
      // å…¶ä»–case...
    }
  }

  // è·å–Unicodeå›¾æ ‡
  private getMenuItemIcon(item: string): string {
    const iconMap: Record<string, string> = {
      'ç¼–è¾‘è®°å½•': 'âœï¸',
      'åˆ é™¤è®°å½•': 'ğŸ—‘ï¸',
      'åˆ†äº«è®°å½•': 'â†—ï¸',
      'å¯¼å‡ºè®°å½•': 'â¤“',
      'è®¾ç½®': 'âš™ï¸',
      'å¸®åŠ©': 'â“'
    };
    return iconMap[item] || 'â–ªï¸'; // é»˜è®¤ç¬¦å·
  }

  build() {
    Column() {
      Button("ä¸‰")
        .onClick(() => {
          this.handlePopup = true;
        })
        .bindPopup(this.handlePopup, {
          builder: this.popupBuilder(),
          placement: Placement.Bottom,
          width: "300vp",
          onStateChange: (e) => {
            if (!e.isVisible) {
              this.handlePopup = false;
            }
          }
        })
    }
  }
}